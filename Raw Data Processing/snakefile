# Load the config file at the top
# configfile: "config.yaml"

out_path     = "Output/"
data_path    = "Data/"
modules_path = "Modules/"
submod_path  = "Modules/Submodules/"

rule all:
    input:
        [f'{out_path}DE.inc', f'{data_path}Power Grid/municipal_connectivity.nc']

rule create_conversion_dictionaries:
    output:
        f"{submod_path}conversion_dictionaries.pkl"
    shell:
        f"""
        python {submod_path}create_name_conversion_dict.py
        """

rule format_energinet_electricity_data_to_xarray:
    output:
        f"{data_path}Timeseries/energinet_eldem.nc"
    shell:
        """
        python Modules/energinet_electricity.py
        """

rule electricity_demands:
    input:
        [f"{modules_path}Submodules/conversion_dictionaries.pkl", f"{data_path}Timeseries/energinet_eldem.nc"]
    output:
        [f"{out_path}DE.inc", f"{out_path}DE_VAR_T.inc", 
        f"{out_path}INDUSTRY_DE.inc", f"{out_path}INDUSTRY_DE_VAR_T.inc", 
        f"{out_path}INDIVUSERS_DE.inc", f"{out_path}INDIVUSERS_DE_VAR_T.inc"]
    shell:
        """
        python Modules/createDE.py --conversion-file={input[0]} --el-dataset={input[1]}
        """

rule get_grid_from_Balmorel:
    output:
        f"{data_path}Power Grid/municipal_connectivity.nc"
    shell:
        """
        python Modules/Submodules/get_grid.py
        """

rule do_clustering:
    input:
        f"{data_path}Power Grid/municipal_connectivity.nc"
    shell:
        """
        python Modules/clustering.py
        """
